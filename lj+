<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Usando canvas to blob</title>
</head>
<body>
  <video id="myVideo" width="200" height="200" autoplay></video>
  <br>
  <button id="snap">Take photo</button>
  <canvas id="micanvas" width="200" height="200"></canvas>
  <br>
  <button id="generarblob">Subir</button>
  <div id="divImagenesStorage"></div>
  <script src="https://www.gstatic.com/firebasejs/5.2.0/firebase.js"></script>
  <script>
    // Conexion Firebase
    var config = {
    apiKey: "AIzaSyD2y4opZXHVS-3lvikuPvc4O_I7yV0v1IU",
    authDomain: "wework-e517b.firebaseapp.com",
    databaseURL: "https://wework-e517b.firebaseio.com",
    projectId: "wework-e517b",
    storageBucket: "wework-e517b.appspot.com",
    messagingSenderId: "904846057196"
    };
    firebase.initializeApp(config);
  </script>
  <script type="text/javascript">
    var dataImages = firebase.storage().ref('userPhotos');
    var video = document.getElementById('myVideo');
    if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia){
      navigator.mediaDevices.getUserMedia({ video:true, audio:false}).then(function(stream){
        video.src=window.URL.createObjectURL(stream);
      })
    }
    var myCanvas = document.getElementById('micanvas');
    var context = myCanvas.getContext('2d');
    document.getElementById('snap').addEventListener('click', function(){
      context.drawImage(video,0,0,200,200);
      var blob = video.src;
    });
    document.getElementById('generarblob').addEventListener('click', function() {
      //genero un blob del canvas
      myCanvas.toBlob(function(blob) {
        console.log('Este es el blob: ', blob);
        chargeStorage(blob);
      }, 'image/jpeg', 0.8);
    })
    function chargeStorage(blob) {
      var uploadTask = firebase.storage().ref('Photos/');
      uploadTask.child('funk.jpg').put(blob);
    }
    var storageRef = firebase.storage().ref("Photos/fiore.jpg");
    storageRef.getDownloadURL().then(function(url) {
      console.log(url);
      document.getElementById('divImagenesStorage').innerHTML = `<img src=${url} />`;
    });
  </script>
</body>
</html>
